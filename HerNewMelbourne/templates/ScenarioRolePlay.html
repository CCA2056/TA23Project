{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Scenario</title>
    <link rel="stylesheet" href="{% static 'css/scenarioRolePlayStyle.css' %}">
    <link rel="stylesheet" href='{% static "css/navbar.css" %}'>
    <link rel="stylesheet" href='{% static "css/variables.css" %}'>

    <!-- Cinzel Decorative -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&display=swap"
        rel="stylesheet">
    <!-- Font Awesome-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

</head>

<body>
    <!-- Nav Bar -->
    <nav id="main-nav">
        <!-- Nav Bar Left -->
        <div id="main-nav-left">
            <!-- Logo -->
            <img id="logo" src='{% static "images/logo.png" %}'>
            <!-- Options -->
            <ul id="main-nav-list">
                <li><i class="fa-solid fa-scroll"></i> Map</li>
                <li id="scenarioLink"><i class="fa-solid fa-map"></i> Scenarios</li>
            </ul>
        </div>
        <!-- Title -->
        <div id="main-nav-title">Her New Melbourne</div>
    </nav>

    <!-- The Scenario Role Play-->
    <div id="scenario">
        <h2 id="scenario-title">Scenario Role-Play</h2>
        <p id="scenario-content"></p>
        <p id="question"></p>
        <form id="responseForm">
            <p>Please select your response:</p>
            <div id="response-options"></div>
        </form>
        <button id="nextButton">Next</button>
        <p id="feedback"></p>
        <p id="reference"></p>
        <p id="donefeedback"></p>
        <button id="backtolist">Back to Scenario Role-play List</button>
    </div>

    <script>
        document.getElementById('scenarioLink').addEventListener('click', function () {
            window.location.href = '/scenario-role-play-list'; // Redirect to the scenario role play list page
        });

        //Redirection function for the back to scenario role-play list button 
        document.getElementById('backtolist').addEventListener('click', function () {
            window.location.href = '/scenario-role-play-list'; // Redirect to the scenario role play list page
        });
    
        document.addEventListener("DOMContentLoaded", function () {
            const index = sessionStorage.getItem('currentScenarioIndex');
            const fileName = `scenario${index}.json`;
            const basePath = '{% static "" %}'; // Get the base static path from Django
            const filePath = basePath + fileName; // Construct the full path
    
            fetch(filePath)
                .then(response => response.json())
                .then(scenarioObject => {
                    const scenarios = scenarioObject.scenarios; // Adjusted for the new JSON structure
                    let currentStep = 0;
    
                    function loadScenarioStep(stepIndex) {
                        document.getElementById('backtolist').style.display = 'none';
                        //document.getElementById('donefeedback').style.display = 'none';
                        const step = scenarios[stepIndex]; // Accessing scenarios array
                        let content = '';
                        let question = '';
    
                        content += `<strong>Context:</strong> ${step.context}<br>`;
                        document.getElementById('scenario-content').innerHTML = content;

                        question += `<strong>Question:</strong> ${step.question}<br>`;
                        document.getElementById('question').innerHTML = question;
    
                        const responseOptionsContainer = document.getElementById('response-options');
                        responseOptionsContainer.innerHTML = '';
    
                        step.responses.forEach((response, index) => {
                            const radioButton = document.createElement('input');
                            radioButton.type = 'radio';
                            radioButton.id = `response${index}`;
                            radioButton.name = 'response';
                            radioButton.value = index;
    
                            const label = document.createElement('label');
                            label.htmlFor = `response${index}`;
                            label.innerText = response.text;
    
                            responseOptionsContainer.appendChild(radioButton);
                            responseOptionsContainer.appendChild(label);
                            responseOptionsContainer.appendChild(document.createElement('br'));
    
                            radioButton.addEventListener('change', function () {
                                console.log(response.correct);
                                if (response.correct) {
                                    document.getElementById('nextButton').style.display = 'block';
                                    document.getElementById('feedback').style.display = 'block';
                                    document.getElementById('reference').style.display = 'block';
                                    document.getElementById('feedback').innerText = `Your answer is correct. ${response.feedback}`;
                                    document.getElementById('reference').innerText = `Reference: ${step.reference}`;
                                }
                                else {
                                    document.getElementById('nextButton').style.display = 'none';
                                    document.getElementById('reference').style.display = 'none';
                                    document.getElementById('feedback').style.display = 'block';
                                    document.getElementById('feedback').innerText = `Your answer is incorrect. ${response.feedback}`;
                                }
                            });
                        });
                    }
    
                    document.getElementById('nextButton').addEventListener('click', function () {
                        currentStep++;
                        if (currentStep < scenarios.length) {
                            loadScenarioStep(currentStep);
                            document.getElementById('nextButton').style.display = 'none';
                            document.getElementById('feedback').style.display = 'none';
                            document.getElementById('reference').style.display = 'none';
                        } else {
                            // When the user finishes the last step of the scenario, show the back to list button.
                            document.getElementById('backtolist').style.display = 'block';
                            document.getElementById('donefeedback').style.display = 'block';
                            document.getElementById('donefeedback').innerText = `Congratulations! now you have some knowledge of ${scenarioObject.topic}`;
                        }
                    });
                    // Load the first step on page load
                    loadScenarioStep(currentStep);
                })
                .catch(error => console.error('Error loading the scenarios:', error));
        });
    </script>
    

</body>

</html>